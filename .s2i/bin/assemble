#!/bin/bash
set -eo pipefail

S2I_SCRIPT_DIR="/usr/local/s2i"
S2I_SOURCE_DIR="/tmp/src"

echo "Checking for module-specific S2I scripts..."

function check_assemble {
   
  if [ -f $S2I_SOURCE_DIR/$MODULE_DIR/.s2i/bin/assemble ]; then

       echo "Custom assemble script found. Using this instead of the default."
       $S2I_SOURCE_DIR/$MODULE_DIR/.s2i/bin/assemble

   else

       echo "Using default assemble script"
       $S2I_SCRIPT_DIR/assemble
  fi
}

function check_run {

  if [ -f $S2I_SOURCE_DIR/$MODULE_DIR/.s2i/bin/run ]; then

       echo "Custom run script found. Using this instead of the default."

       mkdir -p /opt/$MODULE_DIR/

       cp $S2I_SOURCE_DIR/$MODULE_DIR/.s2i/bin/run /opt/$MODULE_DIR/

   else

       echo "Using default run script"
  fi
}

if [ x"$MODULE_DIR" != "x" ]; then

check_assemble
check_run

fi
